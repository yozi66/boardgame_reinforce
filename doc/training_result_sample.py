import numpy as np
from ray.rllib.utils.torch_compile_utils import TorchCompileWhatToCompile
sample_result = {
  'config': {'_disable_action_flattening': False,
            '_disable_execution_plan_api': -1,
            '_disable_initialize_loss_from_dummy_batch': False,
            '_disable_preprocessor_api': False,
            '_dont_auto_sync_env_runner_states': False,
            '_enable_rl_module_api': -1,
            '_env_to_module_connector': None,
            '_fake_gpus': False,
            '_is_atari': None,
            '_is_online': True,
            '_learner_class': None,
            '_learner_connector': None,
            '_model_config': {},
            '_module_to_env_connector': None,
            '_per_module_overrides': {},
            '_prior_exploration_config': {'type': 'StochasticSampling'},
            '_rl_module_spec': None,
            '_tf_policy_handles_more_than_one_loss': False,
            '_torch_grad_scaler_class': None,
            '_torch_lr_scheduler_classes': None,
            '_train_batch_size_per_learner': 2000,
            '_use_msgpack_checkpoints': False,
            '_validate_config': True,
            'action_mask_key': 'action_mask',
            'action_space': None,
            'actions_in_input_normalized': False,
            'add_default_connectors_to_env_to_module_pipeline': True,
            'add_default_connectors_to_learner_pipeline': True,
            'add_default_connectors_to_module_to_env_pipeline': True,
            'algorithm_config_overrides_per_module': {},
            'always_attach_evaluation_results': -1,
            'auto_wrap_old_gym_envs': -1,
            'batch_mode': 'truncate_episodes',
            'broadcast_env_runner_states': True,
            'broadcast_offline_eval_runner_states': False,
            'callbacks': <class 'ray.rllib.callbacks.callbacks.RLlibCallback'>,
            'callbacks_on_algorithm_init': None,
            'callbacks_on_checkpoint_loaded': None,
            'callbacks_on_env_runners_recreated': None,
            'callbacks_on_environment_created': None,
            'callbacks_on_episode_created': None,
            'callbacks_on_episode_end': None,
            'callbacks_on_episode_start': None,
            'callbacks_on_episode_step': None,
            'callbacks_on_evaluate_end': None,
            'callbacks_on_evaluate_offline_end': None,
            'callbacks_on_evaluate_offline_start': None,
            'callbacks_on_evaluate_start': None,
            'callbacks_on_offline_eval_runners_recreated': None,
            'callbacks_on_sample_end': None,
            'callbacks_on_train_result': None,
            'checkpoint_trainable_policies_only': False,
            'class': <class 'ray.rllib.algorithms.ppo.ppo.PPOConfig'>,
            'clip_actions': False,
            'clip_param': 0.3,
            'clip_rewards': None,
            'compress_observations': False,
            'count_steps_by': 'env_steps',
            'create_env_on_driver': False,
            'create_local_env_runner': True,
            'custom_async_evaluation_function': -1,
            'custom_eval_function': None,
            'custom_resources_per_env_runner': {},
            'custom_resources_per_offline_eval_runner': {},
            'dataset_num_iters_per_eval_runner': 1,
            'dataset_num_iters_per_learner': None,
            'delay_between_env_runner_restarts_s': 60.0,
            'disable_env_checking': False,
            'eager_max_retraces': 20,
            'eager_tracing': True,
            'enable_async_evaluation': -1,
            'enable_connectors': -1,
            'enable_env_runner_and_connector_v2': True,
            'enable_rl_module_and_learner': True,
            'enable_tf1_exec_eagerly': False,
            'entropy_coeff': 0.0,
            'entropy_coeff_schedule': None,
            'env': 'tictactoe',
            'env_config': {},
            'env_runner_cls': None,
            'env_runner_health_probe_timeout_s': 30.0,
            'env_runner_restore_timeout_s': 1800.0,
            'env_task_fn': -1,
            'episode_lookback_horizon': 1,
            'episodes_to_numpy': True,
            'evaluation_auto_duration_max_env_steps_per_sample': 2000,
            'evaluation_auto_duration_min_env_steps_per_sample': 100,
            'evaluation_config': None,
            'evaluation_duration': 10,
            'evaluation_duration_unit': 'episodes',
            'evaluation_force_reset_envs_before_iteration': True,
            'evaluation_interval': None,
            'evaluation_num_env_runners': 0,
            'evaluation_parallel_to_training': False,
            'evaluation_sample_timeout_s': 120.0,
            'exploration_config': {},
            'explore': True,
            'export_native_model_files': False,
            'extra_python_environs_for_driver': {},
            'extra_python_environs_for_worker': {},
            'fake_sampler': False,
            'framework': 'torch',
            'gamma': 0.99,
            'grad_clip': None,
            'grad_clip_by': 'global_norm',
            'gym_env_vectorize_mode': 'sync',
            'ignore_env_runner_failures': False,
            'ignore_final_observation': False,
            'ignore_offline_eval_runner_failures': False,
            'in_evaluation': False,
            'input': 'sampler',
            'input_compress_columns': ['obs', 'new_obs'],
            'input_config': {},
            'input_filesystem': None,
            'input_filesystem_kwargs': {},
            'input_read_batch_size': None,
            'input_read_episodes': False,
            'input_read_method': 'read_parquet',
            'input_read_method_kwargs': {},
            'input_read_sample_batches': False,
            'input_read_schema': {},
            'input_spaces_jsonable': True,
            'iter_batches_kwargs': {},
            'keep_per_episode_custom_metrics': False,
            'kl_coeff': 0.2,
            'kl_target': 0.01,
            'lambda': 1.0,
            'learner_config_dict': {},
            'local_gpu_idx': 0,
            'local_tf_session_args': {'inter_op_parallelism_threads': 8,
                                      'intra_op_parallelism_threads': 8},
            'log_gradients': False,
            'log_level': 'WARN',
            'log_sys_usage': True,
            'logger_config': None,
            'logger_creator': None,
            'lr': 0.0002,
            'lr_schedule': None,
            'map_batches_kwargs': {},
            'materialize_data': False,
            'materialize_mapped_data': True,
            'max_num_env_runner_restarts': 1000,
            'max_num_offline_eval_runner_restarts': 1000,
            'max_requests_in_flight_per_aggregator_actor': 3,
            'max_requests_in_flight_per_env_runner': 1,
            'max_requests_in_flight_per_learner': 3,
            'max_requests_in_flight_per_offline_eval_runner': 1,
            'merge_env_runner_states': 'training_only',
            'metrics_episode_collection_timeout_s': 60.0,
            'metrics_num_episodes_for_smoothing': 100,
            'min_sample_timesteps_per_iteration': 0,
            'min_time_s_per_iteration': None,
            'min_train_timesteps_per_iteration': 0,
            'minibatch_size': 128,
            'model': {'_disable_action_flattening': False,
                      '_disable_preprocessor_api': False,
                      '_time_major': False,
                      '_use_default_native_models': -1,
                      'always_check_shapes': False,
                      'attention_dim': 64,
                      'attention_head_dim': 32,
                      'attention_init_gru_gate_bias': 2.0,
                      'attention_memory_inference': 50,
                      'attention_memory_training': 50,
                      'attention_num_heads': 1,
                      'attention_num_transformer_units': 1,
                      'attention_position_wise_mlp_dim': 32,
                      'attention_use_n_prev_actions': 0,
                      'attention_use_n_prev_rewards': 0,
                      'conv_activation': 'relu',
                      'conv_bias_initializer': None,
                      'conv_bias_initializer_config': None,
                      'conv_filters': None,
                      'conv_kernel_initializer': None,
                      'conv_kernel_initializer_config': None,
                      'conv_transpose_bias_initializer': None,
                      'conv_transpose_bias_initializer_config': None,
                      'conv_transpose_kernel_initializer': None,
                      'conv_transpose_kernel_initializer_config': None,
                      'custom_action_dist': None,
                      'custom_model': None,
                      'custom_model_config': {},
                      'custom_preprocessor': None,
                      'dim': 84,
                      'encoder_latent_dim': None,
                      'fcnet_activation': 'tanh',
                      'fcnet_bias_initializer': None,
                      'fcnet_bias_initializer_config': None,
                      'fcnet_hiddens': [256, 256],
                      'fcnet_weights_initializer': None,
                      'fcnet_weights_initializer_config': None,
                      'framestack': True,
                      'free_log_std': False,
                      'grayscale': False,
                      'log_std_clip_param': 20.0,
                      'lstm_bias_initializer': None,
                      'lstm_bias_initializer_config': None,
                      'lstm_cell_size': 256,
                      'lstm_use_prev_action': False,
                      'lstm_use_prev_action_reward': -1,
                      'lstm_use_prev_reward': False,
                      'lstm_weights_initializer': None,
                      'lstm_weights_initializer_config': None,
                      'max_seq_len': 20,
                      'no_final_linear': False,
                      'post_fcnet_activation': 'relu',
                      'post_fcnet_bias_initializer': None,
                      'post_fcnet_bias_initializer_config': None,
                      'post_fcnet_hiddens': [],
                      'post_fcnet_weights_initializer': None,
                      'post_fcnet_weights_initializer_config': None,
                      'use_attention': False,
                      'use_lstm': False,
                      'vf_share_layers': False,
                      'zero_mean': True},
            'normalize_actions': True,
            'num_aggregator_actors_per_learner': 0,
            'num_consecutive_env_runner_failures_tolerance': 100,
            'num_cpus_for_main_process': 1,
            'num_cpus_per_env_runner': 1,
            'num_cpus_per_learner': 'auto',
            'num_cpus_per_offline_eval_runner': 1,
            'num_env_runners': 2,
            'num_envs_per_env_runner': 1,
            'num_epochs': 10,
            'num_gpus': 0,
            'num_gpus_per_env_runner': 0,
            'num_gpus_per_learner': 0,
            'num_gpus_per_offline_eval_runner': 0,
            'num_learners': 0,
            'num_offline_eval_runners': 0,
            'observation_filter': 'NoFilter',
            'observation_fn': None,
            'observation_space': None,
            'off_policy_estimation_methods': {},
            'offline_data_class': None,
            'offline_eval_batch_size_per_runner': 256,
            'offline_eval_rl_module_inference_only': False,
            'offline_eval_runner_class': None,
            'offline_eval_runner_health_probe_timeout_s': 30.0,
            'offline_eval_runner_restore_timeout_s': 1800.0,
            'offline_evaluation_duration': 1,
            'offline_evaluation_interval': None,
            'offline_evaluation_parallel_to_training': False,
            'offline_evaluation_timeout_s': 120.0,
            'offline_evaluation_type': None,
            'offline_loss_for_module_fn': None,
            'offline_sampling': False,
            'ope_split_batch_by_episode': True,
            'optimizer': {},
            'output': None,
            'output_compress_columns': ['obs', 'new_obs'],
            'output_config': {},
            'output_filesystem': None,
            'output_filesystem_kwargs': {},
            'output_max_file_size': 67108864,
            'output_max_rows_per_file': None,
            'output_write_episodes': True,
            'output_write_method': 'write_parquet',
            'output_write_method_kwargs': {},
            'output_write_remaining_data': False,
            'placement_strategy': 'PACK',
            'policies': {'p0': (None, None, None, {}),
                         'p1': (None, None, None, {})},
            'policies_to_train': None,
            'policy_map_cache': -1,
            'policy_map_capacity': 100,
            'policy_mapping_fn': <function policy_mapping_fn at 0x7f1d795256c0>,
            'policy_states_are_swappable': False,
            'postprocess_inputs': False,
            'prelearner_buffer_class': None,
            'prelearner_buffer_kwargs': {},
            'prelearner_class': None,
            'prelearner_module_synch_period': 10,
            'preprocessor_pref': 'deepmind',
            'remote_env_batch_wait_ms': 0,
            'remote_worker_envs': False,
            'render_env': False,
            'replay_sequence_length': None,
            'restart_failed_env_runners': True,
            'restart_failed_offline_eval_runners': True,
            'restart_failed_sub_environments': False,
            'rollout_fragment_length': 'auto',
            'sample_collector': <class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>,
            'sample_timeout_s': 60.0,
            'sampler_perf_stats_ema_coef': None,
            'seed': None,
            'sgd_minibatch_size': -1,
            'shuffle_batch_per_epoch': True,
            'shuffle_buffer_size': 0,
            'simple_optimizer': True,
            'stats_cls_lookup': {'ema': <class 'ray.rllib.utils.metrics.stats.ema.EmaStats'>,
                                 'item': <class 'ray.rllib.utils.metrics.stats.item.ItemStats'>,
                                 'item_series': <class 'ray.rllib.utils.metrics.stats.item_series.ItemSeriesStats'>,
                                 'lifetime_sum': <class 'ray.rllib.utils.metrics.stats.lifetime_sum.LifetimeSumStats'>,
                                 'max': <class 'ray.rllib.utils.metrics.stats.max.MaxStats'>,
                                 'mean': <class 'ray.rllib.utils.metrics.stats.mean.MeanStats'>,
                                 'min': <class 'ray.rllib.utils.metrics.stats.min.MinStats'>,
                                 'percentiles': <class 'ray.rllib.utils.metrics.stats.percentiles.PercentilesStats'>,
                                 'sum': <class 'ray.rllib.utils.metrics.stats.sum.SumStats'>},
            'sync_filters_on_rollout_workers_timeout_s': 10.0,
            'synchronize_filters': -1,
            'tf_session_args': {'allow_soft_placement': True,
                                'device_count': {'CPU': 1},
                                'gpu_options': {'allow_growth': True},
                                'inter_op_parallelism_threads': 2,
                                'intra_op_parallelism_threads': 2,
                                'log_device_placement': False},
            'torch_compile_learner': False,
            'torch_compile_learner_dynamo_backend': 'inductor',
            'torch_compile_learner_dynamo_mode': None,
            'torch_compile_learner_what_to_compile': <TorchCompileWhatToCompile.FORWARD_TRAIN: 'forward_train'>,
            'torch_compile_worker': False,
            'torch_compile_worker_dynamo_backend': 'onnxrt',
            'torch_compile_worker_dynamo_mode': None,
            'torch_ddp_kwargs': {},
            'torch_skip_nan_gradients': False,
            'train_batch_size': 4000,
            'update_worker_filter_stats': True,
            'use_critic': True,
            'use_gae': True,
            'use_kl_loss': True,
            'use_worker_filter_stats': True,
            'validate_env_runners_after_construction': True,
            'validate_offline_eval_runners_after_construction': True,
            'vf_clip_param': 10.0,
            'vf_loss_coeff': 1.0,
            'vf_share_layers': -1,
            'worker_cls': -1},
 'date': '2026-01-07_08-38-40',
 'done': False,
 'env_runner_group': {'actor_manager_num_outstanding_async_reqs': 2},
 'env_runners': {'agent_episode_returns_mean': {'player1': np.float64(-21.0),
                                                'player2': np.float64(-19.75)},
                 'agent_steps': {'player1': np.float64(7.77),
                                 'player2': np.float64(7.79)},
                 'connector_pipeline_timer': np.float64(0.0003790519995163777),
                 'env_reset_timer': np.float64(0.00010212399956799345),
                 'env_step_timer': np.float64(2.676820767734326e-05),
                 'env_to_module_connector': {'connector_pipeline_timer': np.float64(0.00013074741530318633),
                                             'timers': {'connectors': {'add_observations_from_episodes_to_batch': np.float64(1.7386980835421715e-05),
                                                                       'add_states_from_episodes_to_batch': np.float64(4.727126151658702e-06),
                                                                       'add_time_dim_to_batch_and_zero_pad': np.float64(9.170436143096824e-06),
                                                                       'agent_to_module_mapping': np.float64(3.841839336567823e-06),
                                                                       'batch_individual_items': np.float64(1.6026922542306452e-05),
                                                                       'numpy_to_tensor': np.float64(2.8238844951730887e-05)}}},
                 'env_to_module_sum_episodes_length_in': np.float64(11.669638267412687),
                 'env_to_module_sum_episodes_length_out': np.float64(11.669638267412687),
                 'episode_duration_sec_mean': np.float64(0.014767918380075571),
                 'episode_len_max': np.int64(46),
                 'episode_len_mean': np.float64(15.56),
                 'episode_len_min': np.int64(5),
                 'episode_return_max': np.float64(0.0),
                 'episode_return_mean': np.float64(-40.75),
                 'episode_return_min': np.float64(-185.0),
                 'module_episode_returns_mean': {'p1': np.float64(-20.65)},
                 'module_to_env_connector': {'connector_pipeline_timer': np.float64(0.00033710838563746334),
                                             'timers': {'connectors': {'get_actions': np.float64(0.0001629045818513283),
                                                                       'listify_data_for_vector_env': np.float64(7.149863547302803e-06),
                                                                       'module_to_agent_unmapping': np.float64(3.2985644914462077e-06),
                                                                       'normalize_and_clip_actions': np.float64(2.6255538781617193e-05),
                                                                       'remove_single_ts_time_rank_from_batch': np.float64(1.3186794046261422e-06),
                                                                       'tensor_to_numpy': np.float64(4.453940259430821e-05),
                                                                       'un_batch_to_individual_items': np.float64(1.7543812824382645e-05)}}},
                 'num_agent_steps_sampled': {'player1': np.int64(1001),
                                             'player2': np.int64(999)},
                 'num_agent_steps_sampled_lifetime': {'player1': 1001.0,
                                                      'player2': 999.0},
                 'num_env_steps_sampled': np.int64(2000),
                 'num_env_steps_sampled_lifetime': 2000.0,
                 'num_env_steps_sampled_lifetime_throughput': {'throughput_since_last_reduce': 36.3752333104954,
                                                               'throughput_since_last_restore': 36.37522692692371},
                 'num_episodes': np.int64(128),
                 'num_episodes_lifetime': 128.0,
                 'num_module_steps_sampled': {'p1': np.int64(2000)},
                 'num_module_steps_sampled_lifetime': {'p1': 2000.0},
                 'rlmodule_inference_timer': np.float64(0.00012974111660630274),
                 'sample': np.float64(0.9660600340002929),
                 'timers': {'connectors': {'add_observations_from_episodes_to_batch': np.float64(3.553099941200344e-05),
                                           'add_states_from_episodes_to_batch': np.float64(6.494500667031389e-06),
                                           'add_time_dim_to_batch_and_zero_pad': np.float64(2.11669994314434e-05),
                                           'agent_to_module_mapping': np.float64(6.161999408504926e-06),
                                           'batch_individual_items': np.float64(3.239899979234906e-05),
                                           'numpy_to_tensor': np.float64(6.916650090715848e-05)}},
                 'weights_seq_no': np.float64(0.0)},
 'fault_tolerance': {'num_healthy_workers': 2, 'num_remote_worker_restarts': 0},
 'hostname': 'FJ5430',
 'iterations_since_restore': 1,
 'learners': {'__all_modules__': {'learner_connector': {'connector_pipeline_timer': np.float64(0.2735795970002073),
                                                        'timers': {'connectors': {'add_columns_from_episodes_to_train_batch': np.float64(0.022244303001571097),
                                                                                  'add_observations_from_episodes_to_batch': np.float64(0.001384266000968637),
                                                                                  'add_one_ts_to_episodes_and_truncate': np.float64(0.011036361000151373),
                                                                                  'add_states_from_episodes_to_batch': np.float64(1.1256999641773291e-05),
                                                                                  'add_time_dim_to_batch_and_zero_pad': np.float64(3.681399903143756e-05),
                                                                                  'agent_to_module_mapping': np.float64(0.0010236130001430865),
                                                                                  'batch_individual_items': np.float64(0.13672958099959942),
                                                                                  'general_advantage_estimation': np.float64(0.10009380600058648),
                                                                                  'numpy_to_tensor': np.float64(0.0001896660014608642)}}},
                                  'learner_connector_sum_episodes_length_in': np.float64(2000.0),
                                  'learner_connector_sum_episodes_length_out': np.float64(2000.0),
                                  'num_env_steps_trained': np.int64(354000),
                                  'num_env_steps_trained_lifetime': 354000.0,
                                  'num_env_steps_trained_lifetime_throughput': {'throughput_since_last_reduce': 6438.388407205826,
                                                                                'throughput_since_last_restore': 6438.388259193272},
                                  'num_env_steps_trained_throughput': np.float64(6438.401442746888),
                                  'num_module_steps_trained': np.int64(22656),
                                  'num_module_steps_trained_lifetime': 22656.0,
                                  'num_module_steps_trained_lifetime_throughput': {'throughput_since_last_reduce': 412.0566784453644,
                                                                                   'throughput_since_last_restore': 412.05667283214035},
                                  'num_module_steps_trained_throughput': np.float64(412.05677991812286),
                                  'num_non_trainable_parameters': np.float64(0.0),
                                  'num_trainable_parameters': np.float64(278548.0)},
              'p0': {'curr_entropy_coeff': np.float64(0.0),
                     'default_optimizer_learning_rate': np.float64(0.0002),
                     'num_trainable_parameters': np.float64(139274.0)},
              'p1': {'curr_entropy_coeff': np.float64(0.0),
                     'curr_kl_coeff': np.float64(0.30000001192092896),
                     'default_optimizer_learning_rate': np.float64(0.0002),
                     'diff_num_grad_updates_vs_sampler_policy': np.float64(1.0),
                     'entropy': np.float64(2.170346736907959),
                     'mean_kl_loss': np.float64(0.023614222183823586),
                     'module_train_batch_size_mean': np.float64(128.0),
                     'num_module_steps_trained': np.int64(22656),
                     'num_module_steps_trained_lifetime': 22656.0,
                     'num_module_steps_trained_lifetime_throughput': {'throughput_since_last_reduce': 412.056256074927,
                                                                      'throughput_since_last_restore': 412.05625080645433},
                     'num_trainable_parameters': np.float64(139274.0),
                     'policy_loss': np.float64(0.15841145813465118),
                     'total_loss': np.float64(8.890640258789062),
                     'vf_explained_var': np.float64(-0.00010120868682861328),
                     'vf_loss': np.float64(8.727505683898926),
                     'vf_loss_unclipped': np.float64(903.5469970703125),
                     'weights_seq_no': np.float64(1.0)}},
 'node_ip': '172.24.62.152',
 'num_env_steps_sampled_lifetime': 2000.0,
 'num_training_step_calls_per_iteration': 1,
 'perf': {'cpu_util_percent': np.float64(95.95333333333335),
          'ram_util_percent': np.float64(17.924000000000003)},
 'pid': 29179,
 'time_since_restore': 56.260881662368774,
 'time_this_iter_s': 56.260881662368774,
 'time_total_s': 56.260881662368774,
 'timers': {'env_runner_sampling_timer': 1.0602890949994617,
            'learner_update_timer': 51.18633580699861,
            'restore_env_runners': 2.1255000319797546e-05,
            'synch_weights': 0.004378808998808381,
            'training_iteration': 52.25282809100099,
            'training_step': 52.25249845500002},
 'timestamp': 1767771520,
 'training_iteration': 1,
 'trial_id': 'default'}
